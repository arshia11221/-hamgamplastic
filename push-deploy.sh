#!/bin/bash
# ูุฑุญูู ฑ: ูพูุด ฺฉุฑุฏู ุชุบุฑุงุช ุจู ฺฏุช
echo "๐ ุฏุฑ ุญุงู ุงุฑุณุงู ุชุบุฑุงุช ุจู ฺฏุช..."
git add .
git commit -m "auto: optimized deployment script"
git push origin main

echo "โ ุงุฑุณุงู ุจู ฺฏุช ุจุง ููููุช ุงูุฌุงู ุดุฏ."
echo "-----------------------------------"
echo "๐ ุฏุฑ ุญุงู ุงุณุชูุฑุงุฑ ุฑู ุณุฑูุฑ (VPS)..."

# ูุฑุญูู ฒ: ุงุชุตุงู ุจู ุณุฑูุฑ ู ุงุฌุฑุง ุฏุณุชูุฑุงุช ุงุณุชูุฑุงุฑ
ssh root@185.213.164.74 << 'EOF'
  
  # ุจู ูพูุดู ูพุฑูฺู ุจุฑูุฏ
  cd /root/-hamgamplastic/Back-end
  
  # ฑ. ูุฑฺฏููู ุชุบุฑ ูุญู ุฑู ุณุฑูุฑ ุฑุง ูพุงฺฉ ฺฉู
  git reset --hard origin/main
  
  # ฒ. ุขุฎุฑู ูุณุฎู ฺฉุฏ ุฑุง ุฏุฑุงูุช ฺฉู
  git pull origin main
  
  # ณ. ฺฉุงูุชูุฑูุง ูุฏู ุฑุง ูุชููู ู ุญุฐู ฺฉู
  docker compose down --remove-orphans
  
  # ด. ููุท ุงูุฌโูุง ูุฏู ุงูพูฺฉุดู ุฑุง ูพุงฺฉ ฺฉู (ุจูููโุณุงุฒ ุดุฏู)
  echo " ูพุงฺฉโุณุงุฒ ุงูุฌโูุง ูุฏู ุงูพูฺฉุดู..."
  docker image prune -f
  
  # ต. ฺฉุงูุชูุฑูุง ุฑุง ุจุง ฺฉุฏ ุฌุฏุฏ ุจุงุฒุณุงุฒ ู ุงุฌุฑุง ฺฉู
  echo " ุฏุฑ ุญุงู ุจุงุฒุณุงุฒ ู ุงุฌุฑุง ูุฌุฏุฏ ฺฉุงูุชูุฑูุง ุฏุงฺฉุฑ..."
  docker compose up -d --build --force-recreate
  
  echo "โ ุงุณุชูุฑุงุฑ ุณุฑุน ุจุง ููููุช ฺฉุงูู ุดุฏ!"
EOF